<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phishing Website Detector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            box-sizing: border-box;
        }

        .page-title {
            margin-bottom: 20px;
            font-size: 2.5rem;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            width: 100%;
        }

        .main-container {
            display: flex;
            flex-direction: row; /* Children side-by-side */
            gap: 20px; /* Space between main content and features panel */
            width: 100%;
            max-width: 1200px; /* Max width for the entire layout */
            align-items: flex-start; /* Align items to the top */
        }

        .scanner-content {
            flex: 2; /* Takes up 2/3 of the space */
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%; /* Ensure it uses the allocated flex space */
        }

        form {
            margin-bottom: 30px;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
            width: 100%; /* Fill scanner-content */
            max-width: 600px; /* Max-width for the form itself */
        }

        #url {
            width: calc(100% - 32px); /* Adjust width considering padding */
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 16px;
            box-shadow: inset 0px 2px 4px rgba(0, 0, 0, 0.1);
            outline: none;
        }

        #url:focus {
            outline: 2px solid #6e8efb;
            background-color: #f3f3f3;
        }

        button {
            padding: 12px 20px;
            background-color: #ff5e62;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background-color 0.3s ease-in-out;
        }

        button:hover {
            background-color: #ff3b3f;
        }

        #updates {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.5);
            text-align: center;
            display: none; /* Hide updates div initially */
            width: 100%;
            max-width: 600px; /* Consistent with form */
        }

        #result {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.5);
            text-align: center;
            width: 100%; /* Consistent with form */
            max-width: 600px;
            word-wrap: break-word;
            display: none; /* Hide result div initially */
        }

        #result h2 {
            margin-bottom: 10px;
            font-size: 22px;
        }

        .features-panel {
            flex: 1; /* Takes up 1/3 of the space */
            padding: 20px;
            background: rgba(0, 0, 0, 0.3); /* Slightly different background */
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
            display: none; /* Initially hidden */
            max-width: 400px; /* Max width for features panel */
            height: fit-content; /* Adjust height to content */
        }

        .features-panel h2 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-align: center;
            color: #fff;
        }

        .features-panel ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .features-panel li {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 0.95em;
            word-wrap: break-word; /* Ensure long feature descriptions wrap */
        }

        .features-panel li strong {
            color: #ffc107; /* Amber color for feature names */
            display: block; /* Makes the feature name take its own line */
            margin-bottom: 3px;
        }
        .features-panel li .description {
            display: block;
            margin-bottom: 3px;
        }

        .features-panel .raw-value {
            font-size: 0.8em;
            color: #ccc;
            display: block; /* Ensure it's on a new line or distinct */
            margin-top: 3px;
        }


        /* Responsive adjustments */
        @media (max-width: 992px) { /* Medium devices (tablets, less than 992px) */
            .main-container {
                flex-direction: column;
                align-items: center; /* Center items when stacked */
            }
            .scanner-content, .features-panel {
                flex: none; /* Reset flex property */
                width: 100%;
                max-width: 600px; /* Allow them to take up similar width when stacked */
            }
            .features-panel {
                margin-top: 20px; /* Add space when stacked */
            }
        }

        @media (max-width: 576px) { /* Small devices (landscape phones, 576px and down) */
            .page-title { font-size: 2rem; }
            #url { font-size: 14px; }
            button { font-size: 14px; }
            #result h2 { font-size: 20px; }
            .features-panel h2 { font-size: 1.3rem; }
            .features-panel li { font-size: 0.9em; }
        }
    </style>
</head>
<body>
    <h1 class="page-title">Phishing Website Detector</h1>

    <div class="main-container">
        <div class="scanner-content">
            <form id="scan-form">
                <label for="url" style="display: block; margin-bottom: 10px; font-size: 18px; font-weight: bold;">Enter the URL to Scan</label>
                <input type="url" id="url" name="url" placeholder="https://example.com" required>
                <button type="submit">Scan URL</button>
            </form>
            <div id="updates">
                <p>Awaiting updates...</p>
            </div>
            <div id="result"></div>
        </div>

        <div id="suspicious-features" class="features-panel">
            <h2>Summary</h2>
            <ul id="features-list">
                </ul>
            <p id="no-features-message" style="text-align:center; display:none;">No specific suspicious features highlighted.</p>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.3/socket.io.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const socket = io(); // Assumes server is at the same origin
    
            // Get references to DOM elements
            const scanForm = document.getElementById('scan-form');
            const urlInput = document.getElementById('url');
            const updatesDiv = document.getElementById('updates');
            const resultDiv = document.getElementById('result');
            const featuresPanel = document.getElementById('suspicious-features');
            const featuresList = document.getElementById('features-list');
            const noFeaturesMessage = document.getElementById('no-features-message');
    
            // Event listener for form submission
            scanForm.addEventListener('submit', function (e) {
                e.preventDefault(); // Prevent default form submission
                const url = urlInput.value.trim(); // Get and trim URL
                if (!url) {
                    alert("Please enter a URL."); // Basic validation
                    return;
                }
    
                // Reset UI elements for a new scan
                updatesDiv.innerHTML = '<p>Starting scan...</p>';
                resultDiv.innerHTML = '';
                featuresList.innerHTML = ''; // Clear previous features
    
                updatesDiv.style.display = 'block';
                resultDiv.style.display = 'none';
                featuresPanel.style.display = 'block'; // Always show features panel
                noFeaturesMessage.style.display = 'none';
    
                // Emit 'start_scan' event to the server
                socket.emit('start_scan', { url: url });
            });
    
            // Event listener for 'scan_update' from server
            socket.on('scan_update', function (data) {
                if (data.error) {
                    updatesDiv.innerHTML = `<p style="color: #ff5e62;">Error: ${data.error}</p>`;
                } else {
                    updatesDiv.innerHTML = `<p>${data.message}</p>`;
                }
            });
    
            // Event listener for 'scan_complete' from server
            socket.on('scan_complete', function (data) {
                updatesDiv.innerHTML = `<p style="color: #28a745;">Scan Complete!</p>`;
    
                const { prediction, probabilities, features: featureValues, feature_names } = data;
    
                // Display the main prediction result
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <h2>Scan Result</h2>
                    <p><strong>Prediction:</strong>
                        <span style="color: ${prediction === 1 ? 'red' : 'green'}; font-size: 1.5rem; font-weight: bold;">
                            ${prediction === 1 ? "Phishing" : "Legitimate"}
                        </span>
                    </p>
                `;
    
                // Populate the features panel
                featuresList.innerHTML = '';
                featuresPanel.style.display = 'block';
    
                if (feature_names && featureValues && feature_names.length === featureValues.length) {
                    feature_names.forEach((name, index) => {
                        const value = featureValues[index];
                        const formattedName = name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    
                        let description = '';
                        let suspiciousTag = '';
    
                        // Heuristic rules to flag suspicious features
                        if (name === 'qty_slash_url' && value > 4) {
                            description = 'High number of slashes in the URL.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'length_url' && value > 25) {
                            description = 'URL is excessively long.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'qty_special_chars' && value > 4) {
                            description = 'Unusual number of special characters in the URL.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'qty_digits_domain' && value > 4) {
                            description = 'Too many digits in the domain name.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'qty_subdomains' && value > 3) {
                            description = 'High number of subdomains.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'presence_of_ip' && value === true) {
                            description = 'URL contains an IP address instead of a domain.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'presence_of_https' && value === false) {
                            description = 'URL does not use HTTPS.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'qty_redirects' && value > 2) {
                            description = 'Excessive number of redirects in the URL.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'qty_queries' && value > 3) {
                            description = 'Too many query parameters in the URL.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'presence_of_at_symbol' && value === true) {
                            description = 'URL contains an "@" symbol.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'qty_misleading_tlds' && value > 0) {
                            description = 'Presence of misleading top-level domains.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'domain_age' && value < 6) {
                            description = 'Domain age is less than 6 months.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'domain_expiry' && value < 12) {
                            description = 'Domain expiry is less than 12 months.';
                            suspiciousTag = ' (Suspicious)';
                        } else if (name === 'presence_of_suspicious_words' && value > 0) {
                            description = 'Contains suspicious words (e.g., "login", "secure", "verify").';
                            suspiciousTag = ' (Suspicious)';
                        } else {
                            description = '';
                            suspiciousTag = '';
                        }

                        // Add more heuristic rules as needed...
    
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0;">
                                <div>
                                    <strong>${formattedName}</strong>
                                    ${description ? `<span class="description" style="font-style: italic; color:white;">(${description})</span>` : ''}
                                </div>
                                <div>
                                    <span class="raw-value" style="font-weight: bold;">${value}</span>
                                    ${suspiciousTag ? `<span style="color: orange; margin-left: 0.5rem;">${suspiciousTag}</span>` : ''}
                                </div>
                            </div>
                        `;
                        featuresList.appendChild(listItem);

                    });
                } else {
                    noFeaturesMessage.style.display = 'block';
                    noFeaturesMessage.textContent = 'No feature data available to display.';
                }
            });
    
            // Handle connection issues
            socket.on('connect_error', (err) => {
                updatesDiv.innerHTML = `<p style="color: #ff5e62;">Connection Error: ${err.message}</p>`;
            });
    
            socket.on('disconnect', () => {
                updatesDiv.innerHTML = `<p style="color: #ffc107;">Disconnected from server.</p>`;
            });
        });
    </script>
    
</body>
</html>
